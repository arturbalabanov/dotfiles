# For the zsh theme -- if the user is DEFAULT_USER, it is not shown
export DEFAULT_USER="arturb"

alias pgcli='~/side/pgcli/venv/bin/pgcli'

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm

function venv {
    source venv/bin/activate && export PYTHONPATH=`pwd`;
}

function pgssh {
	if [[ "$#" -ne 2 ]]; then
		echo "Usage: $0 <container> <db name>"
		return 1
	fi

	container="$1"
	db_name="$2"

	export PGPASSWORD="c0l1n"
	pgcli -h $container -U "colin" $db_name
}

function logssh {
	if [[ "$#" -lt 2 ]]; then
		echo "Usage: $0 <container> <service> [<editor>]"
		return 1
	fi

	orig_dir=$(pwd)

	container="$1"
	service="$2"

	if [[ "$#" -eq 3 ]]; then
		editor="$3"
	else
		editor="$EDITOR"
	fi

	logs_dir=$(mktemp -d)
	combined_log=$(mktemp)

	scp $USER@$container:/var/log/colin/$service.log* $logs_dir
	
	cd $logs_dir
	for gz_log in *.gz; do
		gunzip $gz_log
	done
	
	cat $(ls | sort -n -t '.' -k 3 -r) | sed 's:#012:\n:g' > $combined_log

	cd $orig_dir
	rm -r $logs_dir

	$editor $combined_log
	rm $combined_log
}
